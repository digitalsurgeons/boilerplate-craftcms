"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};"undefined"===_typeof(Craft.Freeform)&&(Craft.Freeform={}),Craft.Freeform.SubmissionsTableView=Craft.TableElementIndexView.extend({startDate:null,endDate:null,startDatepicker:null,endDatepicker:null,$chartExplorer:null,$totalValue:null,$chartContainer:null,$spinner:null,$error:null,$chart:null,$startDate:null,$endDate:null,afterInit:function(){this.$explorerContainer=$('<div class="chart-explorer-container"></div>').prependTo(this.$container),this.createChartExplorer(),this.base()},getStorage:function(t){return Craft.Freeform.SubmissionsTableView.getStorage(this.elementIndex._namespace,t)},setStorage:function(t,e){Craft.Freeform.SubmissionsTableView.setStorage(this.elementIndex._namespace,t,e)},createChartExplorer:function(){var t=$('<div class="chart-explorer"></div>').appendTo(this.$explorerContainer),e=$('<div class="chart-header"></div>').appendTo(t),a=$('<div class="date-range" />').appendTo(e),r=$('<div class="datewrapper"></div>').appendTo(a),s=($('<span class="to light">to</span>').appendTo(a),$('<div class="datewrapper"></div>').appendTo(a)),i=$('<div class="total"></div>').appendTo(e),n=($('<div class="total-label light">'+Craft.t("Total Submissions")+"</div>").appendTo(i),$('<div class="total-value-wrapper"></div>').appendTo(i)),o=$('<span class="total-value">&nbsp;</span>').appendTo(n);this.$chartExplorer=t,this.$totalValue=o,this.$chartContainer=$('<div class="chart-container"></div>').appendTo(t),this.$spinner=$('<div class="spinner hidden" />').prependTo(e),this.$error=$('<div class="error"></div>').appendTo(this.$chartContainer),this.$chart=$('<div class="chart"></div>').appendTo(this.$chartContainer),this.$startDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(r),this.$endDate=$('<input type="text" class="text" size="20" autocomplete="off" />').appendTo(s),this.$startDate.datepicker($.extend({onSelect:$.proxy(this,"handleStartDateChange")},Craft.datepickerOptions)),this.$endDate.datepicker($.extend({onSelect:$.proxy(this,"handleEndDateChange")},Craft.datepickerOptions)),this.startDatepicker=this.$startDate.data("datepicker"),this.endDatepicker=this.$endDate.data("datepicker"),this.addListener(this.$startDate,"keyup","handleStartDateChange"),this.addListener(this.$endDate,"keyup","handleEndDateChange");var d=this.getStorage("startTime")||(new Date).getTime()-2592e6,l=this.getStorage("endTime")||(new Date).getTime();this.setStartDate(new Date(d)),this.setEndDate(new Date(l)),this.loadReport()},handleStartDateChange:function(){this.setStartDate(Craft.Freeform.SubmissionsTableView.getDateFromDatepickerInstance(this.startDatepicker))&&this.loadReport()},handleEndDateChange:function(){this.setEndDate(Craft.Freeform.SubmissionsTableView.getDateFromDatepickerInstance(this.endDatepicker))&&this.loadReport()},setStartDate:function(t){return(!this.startDate||t.getTime()!=this.startDate.getTime())&&(this.startDate=t,this.setStorage("startTime",this.startDate.getTime()),this.$startDate.val(Craft.formatDate(this.startDate)),this.endDate&&this.startDate.getTime()>this.endDate.getTime()&&this.setEndDate(new Date(this.startDate.getTime())),!0)},setEndDate:function(t){return(!this.endDate||t.getTime()!=this.endDate.getTime())&&(this.endDate=t,this.setStorage("endTime",this.endDate.getTime()),this.$endDate.val(Craft.formatDate(this.endDate)),this.startDate&&this.endDate.getTime()<this.startDate.getTime()&&this.setStartDate(new Date(this.endDate.getTime())),!0)},loadReport:function(){var t=this.settings.params;t.startDate=Craft.Freeform.SubmissionsTableView.getDateValue(this.startDate),t.endDate=Craft.Freeform.SubmissionsTableView.getDateValue(this.endDate),this.$spinner.removeClass("hidden"),this.$error.addClass("hidden"),this.$chart.removeClass("error"),Craft.postActionRequest("freeform/api/getSubmissionData",t,$.proxy(function(t,e){if(this.$spinner.addClass("hidden"),"success"==e&&"undefined"==typeof t.error){this.chart||(this.chart=new Craft.charts.Area(this.$chart));var a=new Craft.charts.DataTable(t.dataTable),r={localeDefinition:t.localeDefinition,orientation:t.orientation,formats:t.formats,dataScale:t.scale};this.chart.draw(a,r),this.$totalValue.html(t.totalHtml)}else{var s=Craft.t("An unknown error occurred.");"undefined"!=typeof t&&t&&"undefined"!=typeof t.error&&(s=t.error),this.$error.html(s),this.$error.removeClass("hidden"),this.$chart.addClass("error")}},this))}},{storage:{},getStorage:function(t,e){return Craft.Freeform.SubmissionsTableView.storage[t]&&Craft.Freeform.SubmissionsTableView.storage[t][e]?Craft.Freeform.SubmissionsTableView.storage[t][e]:null},setStorage:function(t,e,a){"undefined"==_typeof(Craft.Freeform.SubmissionsTableView.storage[t])&&(Craft.Freeform.SubmissionsTableView.storage[t]={}),Craft.Freeform.SubmissionsTableView.storage[t][e]=a},getDateFromDatepickerInstance:function(t){return new Date(t.currentYear,t.currentMonth,t.currentDay)},getDateValue:function(t){return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZyZWVmb3JtLXN1Ym1pc3Npb25zLXRhYmxlLXZpZXcuanMiXSwibmFtZXMiOlsiX3R5cGVvZiIsIlN5bWJvbCIsIml0ZXJhdG9yIiwib2JqIiwiY29uc3RydWN0b3IiLCJwcm90b3R5cGUiLCJDcmFmdCIsIkZyZWVmb3JtIiwiU3VibWlzc2lvbnNUYWJsZVZpZXciLCJUYWJsZUVsZW1lbnRJbmRleFZpZXciLCJleHRlbmQiLCJzdGFydERhdGUiLCJlbmREYXRlIiwic3RhcnREYXRlcGlja2VyIiwiZW5kRGF0ZXBpY2tlciIsIiRjaGFydEV4cGxvcmVyIiwiJHRvdGFsVmFsdWUiLCIkY2hhcnRDb250YWluZXIiLCIkc3Bpbm5lciIsIiRlcnJvciIsIiRjaGFydCIsIiRzdGFydERhdGUiLCIkZW5kRGF0ZSIsImFmdGVySW5pdCIsInRoaXMiLCIkZXhwbG9yZXJDb250YWluZXIiLCIkIiwicHJlcGVuZFRvIiwiJGNvbnRhaW5lciIsImNyZWF0ZUNoYXJ0RXhwbG9yZXIiLCJiYXNlIiwiZ2V0U3RvcmFnZSIsImtleSIsImVsZW1lbnRJbmRleCIsIl9uYW1lc3BhY2UiLCJzZXRTdG9yYWdlIiwidmFsdWUiLCJhcHBlbmRUbyIsIiRjaGFydEhlYWRlciIsIiRkYXRlUmFuZ2UiLCIkc3RhcnREYXRlQ29udGFpbmVyIiwiJGVuZERhdGVDb250YWluZXIiLCIkdG90YWwiLCIkdG90YWxWYWx1ZVdyYXBwZXIiLCJ0IiwiZGF0ZXBpY2tlciIsIm9uU2VsZWN0IiwicHJveHkiLCJkYXRlcGlja2VyT3B0aW9ucyIsImRhdGEiLCJhZGRMaXN0ZW5lciIsInN0YXJ0VGltZSIsIkRhdGUiLCJnZXRUaW1lIiwiZW5kVGltZSIsInNldFN0YXJ0RGF0ZSIsInNldEVuZERhdGUiLCJsb2FkUmVwb3J0IiwiaGFuZGxlU3RhcnREYXRlQ2hhbmdlIiwiZ2V0RGF0ZUZyb21EYXRlcGlja2VySW5zdGFuY2UiLCJoYW5kbGVFbmREYXRlQ2hhbmdlIiwiZGF0ZSIsInZhbCIsImZvcm1hdERhdGUiLCJyZXF1ZXN0RGF0YSIsInNldHRpbmdzIiwicGFyYW1zIiwiZ2V0RGF0ZVZhbHVlIiwicmVtb3ZlQ2xhc3MiLCJhZGRDbGFzcyIsInBvc3RBY3Rpb25SZXF1ZXN0IiwicmVzcG9uc2UiLCJ0ZXh0U3RhdHVzIiwiZXJyb3IiLCJjaGFydCIsImNoYXJ0cyIsIkFyZWEiLCJjaGFydERhdGFUYWJsZSIsIkRhdGFUYWJsZSIsImRhdGFUYWJsZSIsImNoYXJ0U2V0dGluZ3MiLCJsb2NhbGVEZWZpbml0aW9uIiwib3JpZW50YXRpb24iLCJmb3JtYXRzIiwiZGF0YVNjYWxlIiwic2NhbGUiLCJkcmF3IiwiaHRtbCIsInRvdGFsSHRtbCIsIm1zZyIsInN0b3JhZ2UiLCJuYW1lc3BhY2UiLCJpbnN0IiwiY3VycmVudFllYXIiLCJjdXJyZW50TW9udGgiLCJjdXJyZW50RGF5IiwiZ2V0RnVsbFllYXIiLCJnZXRNb250aCIsImdldERhdGUiXSwibWFwcGluZ3MiOiJBQUFBLFlBRUEsSUFBSUEsU0FBNEIsa0JBQVhDLFNBQW9ELGdCQUFwQkEsUUFBT0MsU0FBd0IsU0FBVUMsR0FBTyxhQUFjQSxJQUFTLFNBQVVBLEdBQU8sTUFBT0EsSUFBeUIsa0JBQVhGLFNBQXlCRSxFQUFJQyxjQUFnQkgsUUFBVUUsSUFBUUYsT0FBT0ksVUFBWSxlQUFrQkYsR0FRbFEsZUFBQUgsUUFBT00sTUFBTUMsWUFDZkQsTUFBTUMsYUFNUkQsTUFBTUMsU0FBU0MscUJBQXVCRixNQUFNRyxzQkFBc0JDLFFBQzlEQyxVQUFXLEtBQ1hDLFFBQVMsS0FFVEMsZ0JBQWlCLEtBQ2pCQyxjQUFlLEtBRWZDLGVBQWdCLEtBQ2hCQyxZQUFhLEtBQ2JDLGdCQUFpQixLQUNqQkMsU0FBVSxLQUNWQyxPQUFRLEtBQ1JDLE9BQVEsS0FDUkMsV0FBWSxLQUNaQyxTQUFVLEtBRVZDLFVBQVcsV0FDVEMsS0FBS0MsbUJBQXFCQyxFQUFFLGdEQUFnREMsVUFBVUgsS0FBS0ksWUFFM0ZKLEtBQUtLLHNCQUVMTCxLQUFLTSxRQUdQQyxXQUFZLFNBQVVDLEdB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QUUsNkJBRU0sb0JBQWIyQixJQUE0QkEsR0FBc0MsbUJBQW5CQSxHQUFTRSxRQUNqRWdCLEVBQU1sQixFQUFTRSxPQUdqQmpELEtBQUtMLE9BQU9vRSxLQUFLRSxHQUNqQmpFLEtBQUtMLE9BQU9pRCxZQUFZLFVBQ3hCNUMsS0FBS0osT0FBT2lELFNBQVMsV0FFdEI3QyxVQUlMa0UsV0FFQTNELFdBQVksU0FBVTRELEVBQVczRCxHQUMvQixNQUFJMUIsT0FBTUMsU0FBU0MscUJBQXFCa0YsUUFBUUMsSUFBY3JGLE1BQU1DLFNBQVNDLHFCQUFxQmtGLFFBQVFDLEdBQVczRCxHQUM1RzFCLE1BQU1DLFNBQVNDLHFCQUFxQmtGLFFBQVFDLEdBQVczRCxHQUd6RCxNQUdURyxXQUFZLFNBQVV3RCxFQUFXM0QsRUFBS0ksR0FDaEMsYUFBQXBDLFFBQU9NLE1BQU1DLFNBQVNDLHFCQUFxQmtGLFFBQVFDLE1BQ3JEckYsTUFBTUMsU0FBU0MscUJBQXFCa0YsUUFBUUMsT0FHOUNyRixNQUFNQyxTQUFTQyxxQkFBcUJrRixRQUFRQyxHQUFXM0QsR0FBT0ksR0FHaEV1Qiw4QkFBK0IsU0FBVWlDLEdBQ3ZDLE1BQU8sSUFBSXhDLE1BQUt3QyxFQUFLQyxZQUFhRCxFQUFLRSxhQUFjRixFQUFLRyxhQUc1RDVCLGFBQWMsU0FBVU4sR0FDdEIsTUFBT0EsR0FBS21DLGNBQWdCLEtBQU9uQyxFQUFLb0MsV0FBYSxHQUFLLElBQU1wQyxFQUFLcUMiLCJmaWxlIjoiZnJlZWZvcm0tc3VibWlzc2lvbnMtdGFibGUtdmlldy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBGcmVlZm9ybSBmb3IgQ3JhZnRcbiAqXG4gKiBAcGFja2FnZSAgICAgICBTb2xzcGFjZTpGcmVlZm9ybVxuICogQGF1dGhvciAgICAgICAgU29sc3BhY2UsIEluYy5cbiAqIEBjb3B5cmlnaHQgICAgIENvcHlyaWdodCAoYykgMjAwOC0yMDE2LCBTb2xzcGFjZSwgSW5jLlxuICogQGxpbmsgICAgICAgICAgaHR0cHM6Ly9zb2xzcGFjZS5jb20vY3JhZnQvZnJlZWZvcm1cbiAqIEBsaWNlbnNlICAgICAgIGh0dHBzOi8vc29sc3BhY2UuY29tL3NvZnR3YXJlL2xpY2Vuc2UtYWdyZWVtZW50XG4gKi9cblxuaWYgKHR5cGVvZiBDcmFmdC5GcmVlZm9ybSA9PT0gdHlwZW9mIHVuZGVmaW5lZCkge1xuICBDcmFmdC5GcmVlZm9ybSA9IHt9O1xufVxuXG4vKipcbiAqIENsYXNzIENyYWZ0LkZyZWVmb3JtLlN1Ym1pc3Npb25zVGFibGVWaWV3XG4gKi9cbkNyYWZ0LkZyZWVmb3JtLlN1Ym1pc3Npb25zVGFibGVWaWV3ID0gQ3JhZnQuVGFibGVFbGVtZW50SW5kZXhWaWV3LmV4dGVuZCh7XG4gICAgc3RhcnREYXRlOiBudWxsLFxuICAgIGVuZERhdGU6IG51bGwsXG5cbiAgICBzdGFydERhdGVwaWNrZXI6IG51bGwsXG4gICAgZW5kRGF0ZXBpY2tlcjogbnVsbCxcblxuICAgICRjaGFydEV4cGxvcmVyOiBudWxsLFxuICAgICR0b3RhbFZhbHVlOiBudWxsLFxuICAgICRjaGFydENvbnRhaW5lcjogbnVsbCxcbiAgICAkc3Bpbm5lcjogbnVsbCxcbiAgICAkZXJyb3I6IG51bGwsXG4gICAgJGNoYXJ0OiBudWxsLFxuICAgICRzdGFydERhdGU6IG51bGwsXG4gICAgJGVuZERhdGU6IG51bGwsXG5cbiAgICBhZnRlckluaXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuJGV4cGxvcmVyQ29udGFpbmVyID0gJCgnPGRpdiBjbGFzcz1cImNoYXJ0LWV4cGxvcmVyLWNvbnRhaW5lclwiPjwvZGl2PicpLnByZXBlbmRUbyh0aGlzLiRjb250YWluZXIpO1xuXG4gICAgICB0aGlzLmNyZWF0ZUNoYXJ0RXhwbG9yZXIoKTtcblxuICAgICAgdGhpcy5iYXNlKCk7XG4gICAgfSxcblxuICAgIGdldFN0b3JhZ2U6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgIHJldHVybiBDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5nZXRTdG9yYWdlKHRoaXMuZWxlbWVudEluZGV4Ll9uYW1lc3BhY2UsIGtleSk7XG4gICAgfSxcblxuICAgIHNldFN0b3JhZ2U6IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICBDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5zZXRTdG9yYWdlKHRoaXMuZWxlbWVudEluZGV4Ll9uYW1lc3BhY2UsIGtleSwgdmFsdWUpO1xuICAgIH0sXG5cbiAgICBjcmVhdGVDaGFydEV4cGxvcmVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBjaGFydCBleHBsb3JlclxuICAgICAgdmFyICRjaGFydEV4cGxvcmVyICAgICAgPSAkKCc8ZGl2IGNsYXNzPVwiY2hhcnQtZXhwbG9yZXJcIj48L2Rpdj4nKS5hcHBlbmRUbyh0aGlzLiRleHBsb3JlckNvbnRhaW5lciksXG4gICAgICAgICAgJGNoYXJ0SGVhZGVyICAgICAgICA9ICQoJzxkaXYgY2xhc3M9XCJjaGFydC1oZWFkZXJcIj48L2Rpdj4nKS5hcHBlbmRUbygkY2hhcnRFeHBsb3JlciksXG4gICAgICAgICAgJGRhdGVSYW5nZSAgICAgICAgICA9ICQoJzxkaXYgY2xhc3M9XCJkYXRlLXJhbmdlXCIgLz4nKS5hcHBlbmRUbygkY2hhcnRIZWFkZXIpLFxuICAgICAgICAgICRzdGFydERhdGVDb250YWluZXIgPSAkKCc8ZGl2IGNsYXNzPVwiZGF0ZXdyYXBwZXJcIj48L2Rpdj4nKS5hcHBlbmRUbygkZGF0ZVJhbmdlKSxcbiAgICAgICAgICAkdG8gICAgICAgICAgICAgICAgID0gJCgnPHNwYW4gY2xhc3M9XCJ0byBsaWdodFwiPnRvPC9zcGFuPicpLmFwcGVuZFRvKCRkYXRlUmFuZ2UpLFxuICAgICAgICAgICRlbmREYXRlQ29udGFpbmVyICAgPSAkKCc8ZGl2IGNsYXNzPVwiZGF0ZXdyYXBwZXJcIj48L2Rpdj4nKS5hcHBlbmRUbygkZGF0ZVJhbmdlKSxcbiAgICAgICAgICAkdG90YWwgICAgICAgICAgICAgID0gJCgnPGRpdiBjbGFzcz1cInRvdGFsXCI+PC9kaXY+JykuYXBwZW5kVG8oJGNoYXJ0SGVhZGVyKSxcbiAgICAgICAgICAkdG90YWxMYWJlbCAgICAgICAgID0gJCgnPGRpdiBjbGFzcz1cInRvdGFsLWxhYmVsIGxpZ2h0XCI+JyArIENyYWZ0LnQoJ1RvdGFsIFN1Ym1pc3Npb25zJykgKyAnPC9kaXY+JykuYXBwZW5kVG8oJHRvdGFsKSxcbiAgICAgICAgICAkdG90YWxWYWx1ZVdyYXBwZXIgID0gJCgnPGRpdiBjbGFzcz1cInRvdGFsLXZhbHVlLXdyYXBwZXJcIj48L2Rpdj4nKS5hcHBlbmRUbygkdG90YWwpLFxuICAgICAgICAgICR0b3RhbFZhbHVlICAgICAgICAgICAgID0gJCgnPHNwYW4gY2xhc3M9XCJ0b3RhbC12YWx1ZVwiPiZuYnNwOzwvc3Bhbj4nKS5hcHBlbmRUbygkdG90YWxWYWx1ZVdyYXBwZXIpO1xuXG4gICAgICB0aGlzLiRjaGFydEV4cGxvcmVyICA9ICRjaGFydEV4cGxvcmVyO1xuICAgICAgdGhpcy4kdG90YWxWYWx1ZSAgICAgPSAkdG90YWxWYWx1ZTtcbiAgICAgIHRoaXMuJGNoYXJ0Q29udGFpbmVyID0gJCgnPGRpdiBjbGFzcz1cImNoYXJ0LWNvbnRhaW5lclwiPjwvZGl2PicpLmFwcGVuZFRvKCRjaGFydEV4cGxvcmVyKTtcbiAgICAgIHRoaXMuJHNwaW5uZXIgICAgICAgID0gJCgnPGRpdiBjbGFzcz1cInNwaW5uZXIgaGlkZGVuXCIgLz4nKS5wcmVwZW5kVG8oJGNoYXJ0SGVhZGVyKTtcbiAgICAgIHRoaXMuJGVycm9yICAgICAgICAgID0gJCgnPGRpdiBjbGFzcz1cImVycm9yXCI+PC9kaXY+JykuYXBwZW5kVG8odGhpcy4kY2hhcnRDb250YWluZXIpO1xuICAgICAgdGhpcy4kY2hhcnQgICAgICAgICAgPSAkKCc8ZGl2IGNsYXNzPVwiY2hhcnRcIj48L2Rpdj4nKS5hcHBlbmRUbyh0aGlzLiRjaGFydENvbnRhaW5lcik7XG5cbiAgICAgIHRoaXMuJHN0YXJ0RGF0ZSA9ICQoJzxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwidGV4dFwiIHNpemU9XCIyMFwiIGF1dG9jb21wbGV0ZT1cIm9mZlwiIC8+JykuYXBwZW5kVG8oJHN0YXJ0RGF0ZUNvbnRhaW5lcik7XG4gICAgICB0aGlzLiRlbmREYXRlICAgPSAkKCc8aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cInRleHRcIiBzaXplPVwiMjBcIiBhdXRvY29tcGxldGU9XCJvZmZcIiAvPicpLmFwcGVuZFRvKCRlbmREYXRlQ29udGFpbmVyKTtcblxuICAgICAgdGhpcy4kc3RhcnREYXRlLmRhdGVwaWNrZXIoJC5leHRlbmQoe1xuICAgICAgICBvblNlbGVjdDogJC5wcm94eSh0aGlzLCAnaGFuZGxlU3RhcnREYXRlQ2hhbmdlJylcbiAgICAgIH0sIENyYWZ0LmRhdGVwaWNrZXJPcHRpb25zKSk7XG5cbiAgICAgIHRoaXMuJGVuZERhdGUuZGF0ZXBpY2tlcigkLmV4dGVuZCh7XG4gICAgICAgIG9uU2VsZWN0OiAkLnByb3h5KHRoaXMsICdoYW5kbGVFbmREYXRlQ2hhbmdlJylcbiAgICAgIH0sIENyYWZ0LmRhdGVwaWNrZXJPcHRpb25zKSk7XG5cbiAgICAgIHRoaXMuc3RhcnREYXRlcGlja2VyID0gdGhpcy4kc3RhcnREYXRlLmRhdGEoJ2RhdGVwaWNrZXInKTtcbiAgICAgIHRoaXMuZW5kRGF0ZXBpY2tlciAgID0gdGhpcy4kZW5kRGF0ZS5kYXRhKCdkYXRlcGlja2VyJyk7XG5cbiAgICAgIHRoaXMuYWRkTGlzdGVuZXIodGhpcy4kc3RhcnREYXRlLCAna2V5dXAnLCAnaGFuZGxlU3RhcnREYXRlQ2hhbmdlJyk7XG4gICAgICB0aGlzLmFkZExpc3RlbmVyKHRoaXMuJGVuZERhdGUsICdrZXl1cCcsICdoYW5kbGVFbmREYXRlQ2hhbmdlJyk7XG5cbiAgICAgIC8vIFNldCB0aGUgc3RhcnQvZW5kIGRhdGVzXG4gICAgICB2YXIgc3RhcnRUaW1lID0gdGhpcy5nZXRTdG9yYWdlKCdzdGFydFRpbWUnKSB8fCAoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAtICg2MCAqIDYwICogMjQgKiAzMCAqIDEwMDApKSxcbiAgICAgICAgICBlbmRUaW1lICAgPSB0aGlzLmdldFN0b3JhZ2UoJ2VuZFRpbWUnKSB8fCAoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSk7XG5cbiAgICAgIHRoaXMuc2V0U3RhcnREYXRlKG5ldyBEYXRlKHN0YXJ0VGltZSkpO1xuICAgICAgdGhpcy5zZXRFbmREYXRlKG5ldyBEYXRlKGVuZFRpbWUpKTtcblxuICAgICAgLy8gTG9hZCB0aGUgcmVwb3J0XG4gICAgICB0aGlzLmxvYWRSZXBvcnQoKTtcbiAgICB9LFxuXG4gICAgaGFuZGxlU3RhcnREYXRlQ2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5zZXRTdGFydERhdGUoQ3JhZnQuRnJlZWZvcm0uU3VibWlzc2lvbnNUYWJsZVZpZXcuZ2V0RGF0ZUZyb21EYXRlcGlja2VySW5zdGFuY2UodGhpcy5zdGFydERhdGVwaWNrZXIpKSkge1xuICAgICAgICB0aGlzLmxvYWRSZXBvcnQoKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgaGFuZGxlRW5kRGF0ZUNoYW5nZTogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuc2V0RW5kRGF0ZShDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5nZXREYXRlRnJvbURhdGVwaWNrZXJJbnN0YW5jZSh0aGlzLmVuZERhdGVwaWNrZXIpKSkge1xuICAgICAgICB0aGlzLmxvYWRSZXBvcnQoKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc2V0U3RhcnREYXRlOiBmdW5jdGlvbiAoZGF0ZSkge1xuICAgICAgLy8gTWFrZSBzdXJlIGl0IGhhcyBhY3R1YWxseSBjaGFuZ2VkXG4gICAgICBpZiAodGhpcy5zdGFydERhdGUgJiYgZGF0ZS5nZXRUaW1lKCkgPT0gdGhpcy5zdGFydERhdGUuZ2V0VGltZSgpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zdGFydERhdGUgPSBkYXRlO1xuICAgICAgdGhpcy5zZXRTdG9yYWdlKCdzdGFydFRpbWUnLCB0aGlzLnN0YXJ0RGF0ZS5nZXRUaW1lKCkpO1xuICAgICAgdGhpcy4kc3RhcnREYXRlLnZhbChDcmFmdC5mb3JtYXREYXRlKHRoaXMuc3RhcnREYXRlKSk7XG5cbiAgICAgIC8vIElmIHRoaXMgaXMgYWZ0ZXIgdGhlIGN1cnJlbnQgZW5kIGRhdGUsIHNldCB0aGUgZW5kIGRhdGUgdG8gbWF0Y2ggaXRcbiAgICAgIGlmICh0aGlzLmVuZERhdGUgJiYgdGhpcy5zdGFydERhdGUuZ2V0VGltZSgpID4gdGhpcy5lbmREYXRlLmdldFRpbWUoKSkge1xuICAgICAgICB0aGlzLnNldEVuZERhdGUobmV3IERhdGUodGhpcy5zdGFydERhdGUuZ2V0VGltZSgpKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG5cbiAgICBzZXRFbmREYXRlOiBmdW5jdGlvbiAoZGF0ZSkge1xuICAgICAgLy8gTWFrZSBzdXJlIGl0IGhhcyBhY3R1YWxseSBjaGFuZ2VkXG4gICAgICBpZiAodGhpcy5lbmREYXRlICYmIGRhdGUuZ2V0VGltZSgpID09IHRoaXMuZW5kRGF0ZS5nZXRUaW1lKCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmVuZERhdGUgPSBkYXRlO1xuICAgICAgdGhpcy5zZXRTdG9yYWdlKCdlbmRUaW1lJywgdGhpcy5lbmREYXRlLmdldFRpbWUoKSk7XG4gICAgICB0aGlzLiRlbmREYXRlLnZhbChDcmFmdC5mb3JtYXREYXRlKHRoaXMuZW5kRGF0ZSkpO1xuXG4gICAgICAvLyBJZiB0aGlzIGlzIGJlZm9yZSB0aGUgY3VycmVudCBzdGFydCBkYXRlLCBzZXQgdGhlIHN0YXJ0IGRhdGUgdG8gbWF0Y2ggaXRcbiAgICAgIGlmICh0aGlzLnN0YXJ0RGF0ZSAmJiB0aGlzLmVuZERhdGUuZ2V0VGltZSgpIDwgdGhpcy5zdGFydERhdGUuZ2V0VGltZSgpKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhcnREYXRlKG5ldyBEYXRlKHRoaXMuZW5kRGF0ZS5nZXRUaW1lKCkpKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIGxvYWRSZXBvcnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciByZXF1ZXN0RGF0YSA9IHRoaXMuc2V0dGluZ3MucGFyYW1zO1xuXG4gICAgICByZXF1ZXN0RGF0YS5zdGFydERhdGUgPSBDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5nZXREYXRlVmFsdWUodGhpcy5zdGFydERhdGUpO1xuICAgICAgcmVxdWVzdERhdGEuZW5kRGF0ZSAgID0gQ3JhZnQuRnJlZWZvcm0uU3VibWlzc2lvbnNUYWJsZVZpZXcuZ2V0RGF0ZVZhbHVlKHRoaXMuZW5kRGF0ZSk7XG5cbiAgICAgIHRoaXMuJHNwaW5uZXIucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgdGhpcy4kZXJyb3IuYWRkQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgdGhpcy4kY2hhcnQucmVtb3ZlQ2xhc3MoJ2Vycm9yJyk7XG5cbiAgICAgIENyYWZ0LnBvc3RBY3Rpb25SZXF1ZXN0KCdmcmVlZm9ybS9hcGkvZ2V0U3VibWlzc2lvbkRhdGEnLCByZXF1ZXN0RGF0YSwgJC5wcm94eShmdW5jdGlvbiAocmVzcG9uc2UsIHRleHRTdGF0dXMpIHtcbiAgICAgICAgdGhpcy4kc3Bpbm5lci5hZGRDbGFzcygnaGlkZGVuJyk7XG5cbiAgICAgICAgaWYgKHRleHRTdGF0dXMgPT0gJ3N1Y2Nlc3MnICYmIHR5cGVvZihyZXNwb25zZS5lcnJvcikgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICBpZiAoIXRoaXMuY2hhcnQpIHtcbiAgICAgICAgICAgIHRoaXMuY2hhcnQgPSBuZXcgQ3JhZnQuY2hhcnRzLkFyZWEodGhpcy4kY2hhcnQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciBjaGFydERhdGFUYWJsZSA9IG5ldyBDcmFmdC5jaGFydHMuRGF0YVRhYmxlKHJlc3BvbnNlLmRhdGFUYWJsZSk7XG5cbiAgICAgICAgICB2YXIgY2hhcnRTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgIGxvY2FsZURlZmluaXRpb246IHJlc3BvbnNlLmxvY2FsZURlZmluaXRpb24sXG4gICAgICAgICAgICBvcmllbnRhdGlvbjogcmVzcG9uc2Uub3JpZW50YXRpb24sXG4gICAgICAgICAgICBmb3JtYXRzOiByZXNwb25zZS5mb3JtYXRzLFxuICAgICAgICAgICAgZGF0YVNjYWxlOiByZXNwb25zZS5zY2FsZVxuICAgICAgICAgIH07XG5cbiAgICAgICAgICB0aGlzLmNoYXJ0LmRyYXcoY2hhcnREYXRhVGFibGUsIGNoYXJ0U2V0dGluZ3MpO1xuXG4gICAgICAgICAgdGhpcy4kdG90YWxWYWx1ZS5odG1sKHJlc3BvbnNlLnRvdGFsSHRtbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdmFyIG1zZyA9IENyYWZ0LnQoJ0FuIHVua25vd24gZXJyb3Igb2NjdXJyZWQuJyk7XG5cbiAgICAgICAgICBpZiAodHlwZW9mKHJlc3BvbnNlKSAhPSAndW5kZWZpbmVkJyAmJiByZXNwb25zZSAmJiB0eXBlb2YocmVzcG9uc2UuZXJyb3IpICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBtc2cgPSByZXNwb25zZS5lcnJvcjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLiRlcnJvci5odG1sKG1zZyk7XG4gICAgICAgICAgdGhpcy4kZXJyb3IucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgIHRoaXMuJGNoYXJ0LmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgICB9XG4gICAgICB9LCB0aGlzKSk7XG4gICAgfVxuICB9LFxuICB7XG4gICAgc3RvcmFnZToge30sXG5cbiAgICBnZXRTdG9yYWdlOiBmdW5jdGlvbiAobmFtZXNwYWNlLCBrZXkpIHtcbiAgICAgIGlmIChDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5zdG9yYWdlW25hbWVzcGFjZV0gJiYgQ3JhZnQuRnJlZWZvcm0uU3VibWlzc2lvbnNUYWJsZVZpZXcuc3RvcmFnZVtuYW1lc3BhY2VdW2tleV0pIHtcbiAgICAgICAgcmV0dXJuIENyYWZ0LkZyZWVmb3JtLlN1Ym1pc3Npb25zVGFibGVWaWV3LnN0b3JhZ2VbbmFtZXNwYWNlXVtrZXldO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuXG4gICAgc2V0U3RvcmFnZTogZnVuY3Rpb24gKG5hbWVzcGFjZSwga2V5LCB2YWx1ZSkge1xuICAgICAgaWYgKHR5cGVvZiBDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5zdG9yYWdlW25hbWVzcGFjZV0gPT0gdHlwZW9mIHVuZGVmaW5lZCkge1xuICAgICAgICBDcmFmdC5GcmVlZm9ybS5TdWJtaXNzaW9uc1RhYmxlVmlldy5zdG9yYWdlW25hbWVzcGFjZV0gPSB7fTtcbiAgICAgIH1cblxuICAgICAgQ3JhZnQuRnJlZWZvcm0uU3VibWlzc2lvbnNUYWJsZVZpZXcuc3RvcmFnZVtuYW1lc3BhY2VdW2tleV0gPSB2YWx1ZTtcbiAgICB9LFxuXG4gICAgZ2V0RGF0ZUZyb21EYXRlcGlja2VySW5zdGFuY2U6IGZ1bmN0aW9uIChpbnN0KSB7XG4gICAgICByZXR1cm4gbmV3IERhdGUoaW5zdC5jdXJyZW50WWVhciwgaW5zdC5jdXJyZW50TW9udGgsIGluc3QuY3VycmVudERheSk7XG4gICAgfSxcblxuICAgIGdldERhdGVWYWx1ZTogZnVuY3Rpb24gKGRhdGUpIHtcbiAgICAgIHJldHVybiBkYXRlLmdldEZ1bGxZZWFyKCkgKyAnLScgKyAoZGF0ZS5nZXRNb250aCgpICsgMSkgKyAnLScgKyBkYXRlLmdldERhdGUoKTtcbiAgICB9XG4gIH1cbik7XG4iXX0=
